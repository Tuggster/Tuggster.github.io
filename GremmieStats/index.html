<!DOCTYPE html>
<html>
  <body>

    <h1>GremmieSealBot GremmieStats!</h1>
    <h2>GSB User stats</h2>
    <input type="text" id="userIDBox" placeholder="Place your user ID here!">
    <button type="button" name="getData" onclick="pullWebserverData()">get data!</button>
    <br>
    <p id="dataDisplay">Data will show here.</p>
    <br>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript">


      var createCORSRequest = function(method, url) {
        var xhr = new XMLHttpRequest();
        if ("withCredentials" in xhr) {
          // Most browsers.
          xhr.open(method, url, true);
        } else if (typeof XDomainRequest != "undefined") {
          // IE8 & IE9
          xhr = new XDomainRequest();
          xhr.open(method, url);
        } else {
          // CORS not supported.
          xhr = null;
        }
        return xhr;
      };

      function pullWebserverData(){
        var idBox = document.getElementById("userIDBox");
        var dataBox = document.getElementById("dataDisplay");

        var xhr = createCORSRequest('GET', 'http://18.220.203.155:3000/data?id='+idBox.value, {user: idBox});
        if (!xhr) {
          throw new Error('CORS not supported');
        }

        xhr.onload = function() {
         var responseText = xhr.responseText;

         var data;

         try {
           var responseJSON = JSON.parse(responseText);
           data  = "Sent: " + responseJSON[`sent`] + ". Received: " + responseJSON[`received`];
         } catch (e) {
           data = "Error: " + responseText;
         }

         dataBox.innerHTML = data;
        };

        xhr.withCredentials = false;
        xhr.setRequestHeader('Access-Control-Allow-Headers', 'window.location.href');
        xhr.send();
      }
    </script>

    <a href="../index.html">Want to go home?</a>

  </body>
</html>
